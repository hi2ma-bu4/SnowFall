!function e(t,r,s){function n(a,o){if(!r[a]){if(!t[a]){var p="function"==typeof require&&require;if(!o&&p)return p(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return n(t[a][1][e]||e)}),c,c.exports,e,t,r,s)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<s.length;a++)n(s[a]);return n}({1:[function(e,t,r){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s},t.exports.__esModule=!0,t.exports.default=t.exports},{}],2:[function(e,t,r){var s=e("./arrayLikeToArray.js");t.exports=function(e){if(Array.isArray(e))return s(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./arrayLikeToArray.js":1}],3:[function(e,t,r){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],4:[function(e,t,r){var s=e("./toPropertyKey.js");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}t.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":11}],5:[function(e,t,r){var s=e("./toPropertyKey.js");t.exports=function(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":11}],6:[function(e,t,r){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],7:[function(e,t,r){t.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{}],8:[function(e,t,r){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],9:[function(e,t,r){var s=e("./arrayWithoutHoles.js"),n=e("./iterableToArray.js"),i=e("./unsupportedIterableToArray.js"),a=e("./nonIterableSpread.js");t.exports=function(e){return s(e)||n(e)||i(e)||a()},t.exports.__esModule=!0,t.exports.default=t.exports},{"./arrayWithoutHoles.js":2,"./iterableToArray.js":7,"./nonIterableSpread.js":8,"./unsupportedIterableToArray.js":13}],10:[function(e,t,r){var s=e("./typeof.js").default;t.exports=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":12}],11:[function(e,t,r){var s=e("./typeof.js").default,n=e("./toPrimitive.js");t.exports=function(e){var t=n(e,"string");return"symbol"==s(t)?t:t+""},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":10,"./typeof.js":12}],12:[function(e,t,r){function s(e){return t.exports=s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,s(e)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},{}],13:[function(e,t,r){var s=e("./arrayLikeToArray.js");t.exports=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},{"./arrayLikeToArray.js":1}],14:[function(e,t,r){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.Compiler=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),i=s(e("@babel/runtime/helpers/createClass")),a=s(e("@babel/runtime/helpers/classCallCheck")),o=e("../const/opcodes");function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=(0,i.default)((function e(t,r,s){(0,a.default)(this,e),this.name=t,this.depth=r,this.index=s})),f=(0,i.default)((function e(t){(0,a.default)(this,e),(0,n.default)(this,"store",new Map),(0,n.default)(this,"localCount",0),this.parent=t}),[{key:"define",value:function(e,t){var r=new h(e,t,this.localCount++);return this.store.set(e,r),r}},{key:"resolve",value:function(e){var t=this.store.get(e);return t?{symbol:t,isLocal:!0}:this.parent?this.parent.resolve(e):null}}]);r.Compiler=function(){function e(t,r){var s=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,a.default)(this,e),(0,n.default)(this,"scopeDepth",0),this.ast=t,console.log(t),this.settings=r,this.parentCompiler=i,this.symbolTable=new f(null==i?void 0:i.symbolTable),this.scopeDepth=i?i.scopeDepth+1:0;var o="FunctionDeclaration"===t.type?t.name.name:"main",p="FunctionDeclaration"===t.type?t.params.length:0;this.compiledFunction={name:o,arity:p,chunk:{code:[],constants:[]}},"FunctionDeclaration"===t.type&&t.params.forEach((function(e){return s.symbolTable.define(e.name,s.scopeDepth)}))}return(0,i.default)(e,[{key:"currentChunk",value:function(){return this.compiledFunction.chunk}},{key:"emit",value:function(e){this.currentChunk().code.push(e)}},{key:"emitBytes",value:function(){for(var e=this,t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];r.forEach((function(t){return e.emit(t)}))}},{key:"addConstant",value:function(e){var t=this.currentChunk().constants,r=t.findIndex((function(t){return t===e}));return-1!==r?r:t.push(e)-1}},{key:"emitConstant",value:function(e){this.emitBytes(o.OpCode.PUSH_CONST,this.addConstant(e))}},{key:"emitJump",value:function(e){return this.emit(e),this.emit(255),this.emit(255),this.currentChunk().code.length-2}},{key:"patchJump",value:function(e){var t=this.currentChunk().code.length-e-2;if(t>65535)throw new Error("Compiler Error: Too much code to jump over.");this.currentChunk().code[e]=t>>8&255,this.currentChunk().code[e+1]=255&t}},{key:"emitLoop",value:function(e){this.emit(o.OpCode.JUMP);var t=this.currentChunk().code.length-e+2;if(t>65535)throw new Error("Compiler Error: Loop body too large.");this.emit(t>>8&255),this.emit(255&t)}},{key:"beginScope",value:function(){this.scopeDepth++}},{key:"endScope",value:function(){for(var e=this,t=Array.from(this.symbolTable.store.values()).filter((function(t){return t.depth===e.scopeDepth})).length,r=0;r<t;r++)this.emit(o.OpCode.POP);this.scopeDepth--}},{key:"compileNode",value:function(e){switch(e.type){case"Program":case"BlockStatement":this.compileStatements(e.body);break;case"ExpressionStatement":this.compileExpressionStatement(e);break;case"VariableDeclaration":this.compileVariableDeclaration(e);break;case"Identifier":this.compileIdentifier(e);break;case"NumericLiteral":case"StringLiteral":this.emitConstant(e.value);break;case"IfStatement":this.compileIfStatement(e);break;case"ForStatement":this.compileForStatement(e);break;case"FunctionDeclaration":this.compileFunctionDeclaration(e);break;case"ReturnStatement":this.compileReturnStatement(e);break;case"CallExpression":this.compileCallExpression(e);break;case"UnaryExpression":this.compileUnaryExpression(e);break;case"BinaryExpression":this.compileBinaryExpression(e);break;default:throw new Error("Compiler Error: Unknown AST node type: ".concat(e.type))}}},{key:"compileStatements",value:function(e){var t=this;e.forEach((function(e){return t.compileNode(e)}))}},{key:"compileExpressionStatement",value:function(e){this.compileNode(e.expression),this.emit(o.OpCode.POP)}},{key:"compileVariableDeclaration",value:function(e){e.init?this.compileNode(e.init):this.emit(o.OpCode.PUSH_NULL),0===this.scopeDepth?this.emitBytes(o.OpCode.DEFINE_GLOBAL,this.addConstant(e.identifier.name)):this.symbolTable.define(e.identifier.name,this.scopeDepth)}},{key:"compileIdentifier",value:function(e){if(!this.settings.builtInFunctions[e.name]){var t=this.symbolTable.resolve(e.name);t?this.emitBytes(o.OpCode.GET_LOCAL,t.symbol.index):this.emitBytes(o.OpCode.GET_GLOBAL,this.addConstant(e.name))}}},{key:"compileIfStatement",value:function(e){this.compileNode(e.test);var t=this.emitJump(o.OpCode.JUMP_IF_FALSE);if(this.compileNode(e.consequence),e.alternate){var r=this.emitJump(o.OpCode.JUMP);this.patchJump(t),this.compileNode(e.alternate),this.patchJump(r)}else this.patchJump(t)}},{key:"compileForStatement",value:function(e){this.beginScope(),e.init&&this.compileNode(e.init);var t=this.currentChunk().code.length,r=-1;e.test&&(this.compileNode(e.test),r=this.emitJump(o.OpCode.JUMP_IF_FALSE)),this.compileNode(e.body),e.update&&(this.compileNode(e.update),this.emit(o.OpCode.POP)),this.emitLoop(t),-1!==r&&(this.patchJump(r),this.emit(o.OpCode.POP)),this.endScope()}},{key:"compileFunctionDeclaration",value:function(t){var r=new e(l(l({},t),{},{type:"FunctionDeclaration"}),this.settings,this);r.compile();var s=this.addConstant(r.compiledFunction);this.emitBytes(o.OpCode.PUSH_CONST,s),0===this.scopeDepth?this.emitBytes(o.OpCode.DEFINE_GLOBAL,this.addConstant(t.name.name)):this.symbolTable.define(t.name.name,this.scopeDepth)}},{key:"compileReturnStatement",value:function(e){e.argument?this.compileNode(e.argument):this.emit(o.OpCode.PUSH_NULL),this.emit(o.OpCode.RETURN)}},{key:"compileCallExpression",value:function(e){this.compileNode(e.callee);var t,r=p(e.arguments);try{for(r.s();!(t=r.n()).done;){var s=t.value;this.compileNode(s)}}catch(e){r.e(e)}finally{r.f()}if("Identifier"===e.callee.type&&this.settings.builtInFunctions[e.callee.name]){var n=this.addConstant(e.callee.name);this.emitBytes(o.OpCode.CALL_BUILTIN,n,e.arguments.length)}else this.emitBytes(o.OpCode.CALL,e.arguments.length)}},{key:"compileUnaryExpression",value:function(e){switch(this.compileNode(e.right),e.operator){case"!":this.emit(o.OpCode.NEGATE);break;case"-":this.emit(o.OpCode.NEGATE),this.emit(o.OpCode.SUBTRACT);break;default:throw new Error("Compiler Error: Unknown unary operator ".concat(e.operator))}}},{key:"compileBinaryExpression",value:function(e){switch(this.compileNode(e.left),this.compileNode(e.right),e.operator){case"+":this.emit(o.OpCode.ADD);break;case"-":this.emit(o.OpCode.SUBTRACT);break;case"*":this.emit(o.OpCode.MULTIPLY);break;case"/":this.emit(o.OpCode.DIVIDE);break;case"==":this.emit(o.OpCode.EQUAL);break;case"!=":this.emit(o.OpCode.NOT_EQUAL);break;case"<":this.emit(o.OpCode.LESS_THAN);break;case">":this.emit(o.OpCode.GREATER_THAN);break;default:throw new Error("Compiler Error: Unknown binary operator ".concat(e.operator))}}},{key:"compile",value:function(){return"Program"===this.ast.type?(this.compileNode(this.ast),this.emit(o.OpCode.PUSH_NULL),this.emit(o.OpCode.RETURN)):"FunctionDeclaration"===this.ast.type&&(this.compileNode(this.ast.body),this.emit(o.OpCode.PUSH_NULL),this.emit(o.OpCode.RETURN)),this.compiledFunction}}])}()},{"../const/opcodes":17,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/defineProperty":5,"@babel/runtime/helpers/interopRequireDefault":6}],15:[function(e,t,r){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.Lexer=void 0;var n=s(e("@babel/runtime/helpers/classCallCheck")),i=s(e("@babel/runtime/helpers/createClass")),a=s(e("@babel/runtime/helpers/defineProperty"));r.Lexer=(0,i.default)((function e(t){(0,n.default)(this,e),(0,a.default)(this,"pos",0),(0,a.default)(this,"keywords",{let:"KEYWORD",if:"KEYWORD",else:"KEYWORD",for:"KEYWORD",function:"KEYWORD",return:"KEYWORD"}),this.source=t,this.currentChar=this.source[this.pos]}),[{key:"advance",value:function(){this.pos++,this.currentChar=this.pos<this.source.length?this.source[this.pos]:null}},{key:"peek",value:function(){return this.pos+1<this.source.length?this.source[this.pos+1]:null}},{key:"string",value:function(){this.advance();for(var e="";'"'!==this.currentChar&&null!==this.currentChar;)e+=this.currentChar,this.advance();if(null===this.currentChar)throw new Error("Lexer Error: Unterminated string.");return this.advance(),{type:"STRING",value:e}}},{key:"number",value:function(){for(var e="";null!==this.currentChar&&/\d/.test(this.currentChar);)e+=this.currentChar,this.advance();return{type:"NUMBER",value:e}}},{key:"skipWhitespace",value:function(){for(;null!==this.currentChar&&/\s/.test(this.currentChar);)this.advance()}},{key:"identifier",value:function(){for(var e="";null!==this.currentChar&&/[a-zA-Z_0-9]/.test(this.currentChar);)e+=this.currentChar,this.advance();return{type:this.keywords[e]||"IDENTIFIER",value:e}}},{key:"tokenize",value:function(){for(var e=[];null!==this.currentChar;)if(/\s/.test(this.currentChar))this.skipWhitespace();else if('"'!==this.currentChar)if(/\d/.test(this.currentChar))e.push(this.number());else if(/[a-zA-Z_]/.test(this.currentChar))e.push(this.identifier());else{switch(this.currentChar){case"=":e.push("="===this.peek()?(this.advance(),{type:"EQUAL_EQUAL",value:"=="}):{type:"EQUALS",value:"="});break;case"!":e.push("="===this.peek()?(this.advance(),{type:"BANG_EQUAL",value:"!="}):{type:"BANG",value:"!"});break;case">":e.push("="===this.peek()?(this.advance(),{type:"GREATER_EQUAL",value:">="}):{type:"GREATER",value:">"});break;case"<":e.push("="===this.peek()?(this.advance(),{type:"LESS_EQUAL",value:"<="}):{type:"LESS",value:"<"});break;case"+":e.push({type:"PLUS",value:"+"});break;case"-":e.push({type:"MINUS",value:"-"});break;case"*":e.push({type:"STAR",value:"*"});break;case"/":e.push({type:"SLASH",value:"/"});break;case"(":e.push({type:"LPAREN",value:"("});break;case")":e.push({type:"RPAREN",value:")"});break;case"{":e.push({type:"LBRACE",value:"{"});break;case"}":e.push({type:"RBRACE",value:"}"});break;case";":e.push({type:"SEMICOLON",value:";"});break;case":":e.push({type:"COLON",value:":"});break;case",":e.push({type:"COMMA",value:","});break;default:throw new Error("Lexer Error: Unknown character: ".concat(this.currentChar))}this.advance()}else e.push(this.string());return e.push({type:"EOF",value:""}),e}}])},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/defineProperty":5,"@babel/runtime/helpers/interopRequireDefault":6}],16:[function(e,t,r){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.Parser=void 0;var n,i=s(e("@babel/runtime/helpers/classCallCheck")),a=s(e("@babel/runtime/helpers/createClass")),o=s(e("@babel/runtime/helpers/defineProperty"));!function(e){e[e.LOWEST=0]="LOWEST",e[e.EQUALS=1]="EQUALS",e[e.LESSGREATER=2]="LESSGREATER",e[e.SUM=3]="SUM",e[e.PRODUCT=4]="PRODUCT",e[e.PREFIX=5]="PREFIX",e[e.CALL=6]="CALL",e[e.INDEX=7]="INDEX"}(n||(n={}));var p={EQUAL_EQUAL:n.EQUALS,BANG_EQUAL:n.EQUALS,LESS:n.LESSGREATER,GREATER:n.LESSGREATER,PLUS:n.SUM,MINUS:n.SUM,SLASH:n.PRODUCT,STAR:n.PRODUCT,LPAREN:n.CALL};r.Parser=(0,a.default)((function e(t){var r=this;(0,i.default)(this,e),(0,o.default)(this,"pos",0),(0,o.default)(this,"parseIdentifier",(function(){return{type:"Identifier",name:r.currentToken.value}})),(0,o.default)(this,"parseNumericLiteral",(function(){return{type:"NumericLiteral",value:parseFloat(r.currentToken.value)}})),(0,o.default)(this,"parseStringLiteral",(function(){return{type:"StringLiteral",value:r.currentToken.value}})),(0,o.default)(this,"parsePrefixExpression",(function(){var e=r.currentToken.value;return r.advance(),{type:"UnaryExpression",operator:e,right:r.parseExpression(n.PREFIX)}})),(0,o.default)(this,"parseInfixExpression",(function(e){var t=r.currentToken.value,s=r.currentPrecedence();return r.advance(),{type:"BinaryExpression",left:e,operator:t,right:r.parseExpression(s)}})),(0,o.default)(this,"parseGroupedExpression",(function(){r.advance();var e=r.parseExpression(n.LOWEST);return r.expectPeek("RPAREN"),e})),(0,o.default)(this,"parseCallExpression",(function(e){return{type:"CallExpression",callee:e,arguments:r.parseExpressionList("RPAREN")}})),(0,o.default)(this,"parseBlockStatement",(function(){var e=[];for(r.advance();"RBRACE"!==r.currentToken.type&&"EOF"!==r.currentToken.type;){var t=r.parseStatement();t&&e.push(t),r.advance()}return{type:"BlockStatement",body:e}})),(0,o.default)(this,"parseVariableDeclaration",(function(){r.expectPeek("IDENTIFIER");var e,t={type:"Identifier",name:r.currentToken.value};if("COLON"===r.peekToken.type&&(r.advance(),r.advance(),e=r.parseIdentifier()),"EQUALS"!==r.peekToken.type)return{type:"VariableDeclaration",identifier:t,typeAnnotation:e};r.expectPeek("EQUALS"),r.advance();var s=r.parseExpression(n.LOWEST);return"SEMICOLON"===r.peekToken.type&&r.advance(),{type:"VariableDeclaration",identifier:t,typeAnnotation:e,init:s}})),(0,o.default)(this,"parseReturnStatement",(function(){if(r.advance(),"SEMICOLON"===r.currentToken.type)return{type:"ReturnStatement"};var e=r.parseExpression(n.LOWEST);return"SEMICOLON"===r.peekToken.type&&r.advance(),{type:"ReturnStatement",argument:e}})),(0,o.default)(this,"parseIfStatement",(function(){r.advance(),r.expectPeek("LPAREN");var e=r.parseGroupedExpression();r.expectPeek("LBRACE");var t,s=r.parseBlockStatement(),n=r.peekToken,i=n.type,a=n.value;return"KEYWORD"===i&&"else"===a&&(r.advance(),"KEYWORD"===r.peekToken.type&&"if"===r.peekToken.value?(r.advance(),t=r.parseIfStatement()):(r.expectPeek("LBRACE"),t=r.parseBlockStatement())),{type:"IfStatement",test:e,consequence:s,alternate:t}})),(0,o.default)(this,"parseForStatement",(function(){var e,t,s;return r.advance(),r.expectPeek("LPAREN"),r.advance(),"SEMICOLON"!==r.currentToken.type&&(e="KEYWORD"===r.currentToken.type&&"let"===r.currentToken.value?r.parseVariableDeclaration():r.parseExpression(n.LOWEST)),r.expectPeek("SEMICOLON"),r.advance(),"SEMICOLON"!==r.currentToken.type&&(t=r.parseExpression(n.LOWEST)),r.expectPeek("SEMICOLON"),r.advance(),"RPAREN"!==r.currentToken.type&&(s=r.parseExpression(n.LOWEST)),r.expectPeek("RPAREN"),r.expectPeek("LBRACE"),{type:"ForStatement",init:e,test:t,update:s,body:r.parseBlockStatement()}})),(0,o.default)(this,"parseFunctionDeclaration",(function(){r.advance();var e=r.parseIdentifier();r.expectPeek("LPAREN");var t=[];if("RPAREN"!==r.peekToken.type){r.advance();do{r.advance(),t.push(r.parseIdentifier())}while("COMMA"===r.peekToken.type)}return r.expectPeek("RPAREN"),r.expectPeek("LBRACE"),{type:"FunctionDeclaration",name:e,params:t,body:r.parseBlockStatement()}})),(0,o.default)(this,"parseExpressionStatement",(function(){var e=r.parseExpression(n.LOWEST);return"SEMICOLON"===r.peekToken.type&&r.advance(),{type:"ExpressionStatement",expression:e}})),this.tokens=t,this.currentToken=this.tokens[0],this.peekToken=this.tokens[1],this.prefixParseFns=new Map,this.registerPrefix("IDENTIFIER",this.parseIdentifier),this.registerPrefix("NUMBER",this.parseNumericLiteral),this.registerPrefix("STRING",this.parseStringLiteral),this.registerPrefix("BANG",this.parsePrefixExpression),this.registerPrefix("MINUS",this.parsePrefixExpression),this.registerPrefix("LPAREN",this.parseGroupedExpression),this.infixParseFns=new Map,this.registerInfix("PLUS",this.parseInfixExpression),this.registerInfix("MINUS",this.parseInfixExpression),this.registerInfix("SLASH",this.parseInfixExpression),this.registerInfix("STAR",this.parseInfixExpression),this.registerInfix("EQUAL_EQUAL",this.parseInfixExpression),this.registerInfix("BANG_EQUAL",this.parseInfixExpression),this.registerInfix("LESS",this.parseInfixExpression),this.registerInfix("GREATER",this.parseInfixExpression),this.registerInfix("LPAREN",this.parseCallExpression)}),[{key:"advance",value:function(){this.pos++,this.currentToken=this.peekToken,this.peekToken=this.pos+1<this.tokens.length?this.tokens[this.pos+1]:{type:"EOF",value:""}}},{key:"registerPrefix",value:function(e,t){this.prefixParseFns.set(e,t.bind(this))}},{key:"registerInfix",value:function(e,t){this.infixParseFns.set(e,t.bind(this))}},{key:"expectPeek",value:function(e){if(this.peekToken.type!==e)throw new Error("Parser Error: Expected next token to be ".concat(e,", got ").concat(this.peekToken.type," instead."));this.advance()}},{key:"peekPrecedence",value:function(){return p[this.peekToken.type]||n.LOWEST}},{key:"currentPrecedence",value:function(){return p[this.currentToken.type]||n.LOWEST}},{key:"parseExpression",value:function(e){var t=this.prefixParseFns.get(this.currentToken.type);if(!t)throw new Error("Parser Error: No prefix parse function for ".concat(this.currentToken.type," found."));for(var r=t();"SEMICOLON"!==this.peekToken.type&&e<this.peekPrecedence();){var s=this.infixParseFns.get(this.peekToken.type);if(!s)return r;this.advance(),r=s(r)}return r}},{key:"parseExpressionList",value:function(e){var t=[];if(this.peekToken.type===e)return this.advance(),t;for(this.advance(),t.push(this.parseExpression(n.LOWEST));"COMMA"===this.peekToken.type;)this.advance(),this.advance(),t.push(this.parseExpression(n.LOWEST));return this.expectPeek(e),t}},{key:"parseStatement",value:function(){if("KEYWORD"===this.currentToken.type)switch(this.currentToken.value){case"let":return this.parseVariableDeclaration();case"return":return this.parseReturnStatement();case"if":return this.parseIfStatement();case"for":return this.parseForStatement();case"function":return this.parseFunctionDeclaration()}return this.parseExpressionStatement()}},{key:"parse",value:function(){var e={type:"Program",body:[]};for(console.log(this.tokens);"EOF"!==this.currentToken.type;){var t=this.parseStatement();t&&e.body.push(t),this.advance()}return e}}])},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/defineProperty":5,"@babel/runtime/helpers/interopRequireDefault":6}],17:[function(e,t,r){"use strict";var s;Object.defineProperty(r,"__esModule",{value:!0}),r.OpCode=void 0,function(e){e[e.PUSH_CONST=0]="PUSH_CONST",e[e.PUSH_NULL=1]="PUSH_NULL",e[e.ADD=2]="ADD",e[e.SUBTRACT=3]="SUBTRACT",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.EQUAL=6]="EQUAL",e[e.NOT_EQUAL=7]="NOT_EQUAL",e[e.GREATER_THAN=8]="GREATER_THAN",e[e.LESS_THAN=9]="LESS_THAN",e[e.NEGATE=10]="NEGATE",e[e.POP=11]="POP",e[e.DEFINE_GLOBAL=12]="DEFINE_GLOBAL",e[e.GET_GLOBAL=13]="GET_GLOBAL",e[e.SET_GLOBAL=14]="SET_GLOBAL",e[e.GET_LOCAL=15]="GET_LOCAL",e[e.SET_LOCAL=16]="SET_LOCAL",e[e.JUMP=17]="JUMP",e[e.JUMP_IF_FALSE=18]="JUMP_IF_FALSE",e[e.CALL=19]="CALL",e[e.RETURN=20]="RETURN",e[e.CALL_BUILTIN=21]="CALL_BUILTIN"}(s||(r.OpCode=s={}))},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("./main");"undefined"!=typeof window&&(window.SnowFall=s.SnowFall);r.default=s.SnowFall},{"./main":19}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SnowFall=void 0;var s=e("./compiler/compiler"),n=e("./compiler/libs/lexer"),i=e("./compiler/libs/parser"),a=e("./vm/vm"),o={builtInFunctions:{}};function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=new n.Lexer(e).tokenize(),a=new i.Parser(r).parse();return new s.Compiler(a,t).compile()}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;return new a.SnowFallVM(e,t).run()}r.SnowFall={compile:p,run:u,compileAndRun:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;return u(p(e,t),t)}}},{"./compiler/compiler":14,"./compiler/libs/lexer":15,"./compiler/libs/parser":16,"./vm/vm":20}],20:[function(e,t,r){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.SnowFallVM=void 0;var n=s(e("@babel/runtime/helpers/toConsumableArray")),i=s(e("@babel/runtime/helpers/typeof")),a=s(e("@babel/runtime/helpers/classCallCheck")),o=s(e("@babel/runtime/helpers/createClass")),p=s(e("@babel/runtime/helpers/defineProperty")),u=e("../const/opcodes");r.SnowFallVM=(0,o.default)((function e(t,r){(0,a.default)(this,e),(0,p.default)(this,"frames",[]),(0,p.default)(this,"stack",[]),(0,p.default)(this,"globals",new Map),this.settings=r,console.log(t),this.stack.push(t);var s={func:t,ip:0,stackStart:0};this.frames.push(s),this.frame=s}),[{key:"readByte",value:function(){return this.frame.func.chunk.code[this.frame.ip++]}},{key:"readShort",value:function(){this.frame.ip+=2;var e=this.frame.func.chunk.code;return e[this.frame.ip-2]<<8|e[this.frame.ip-1]}},{key:"readConstant",value:function(){return this.frame.func.chunk.constants[this.readByte()]}},{key:"run",value:function(){for(;;){var e=this.readByte();switch(e){case u.OpCode.PUSH_CONST:this.stack.push(this.readConstant());break;case u.OpCode.PUSH_NULL:this.stack.push(null);break;case u.OpCode.POP:this.stack.pop();break;case u.OpCode.DEFINE_GLOBAL:var t=this.readConstant();this.globals.set(t,this.stack[this.stack.length-1]),this.stack.pop();break;case u.OpCode.GET_GLOBAL:var r=this.readConstant();if(!this.globals.has(r))throw new Error("VM Error: Undefined global variable '".concat(r,"'."));this.stack.push(this.globals.get(r));break;case u.OpCode.SET_GLOBAL:var s=this.readConstant();if(!this.globals.has(s))throw new Error("VM Error: Undefined global variable '".concat(s,"'."));this.globals.set(s,this.stack[this.stack.length-1]);break;case u.OpCode.GET_LOCAL:var a=this.readByte();this.stack.push(this.stack[this.frame.stackStart+a]);break;case u.OpCode.SET_LOCAL:var o=this.readByte();this.stack[this.frame.stackStart+o]=this.stack[this.stack.length-1];break;case u.OpCode.EQUAL:var p=this.stack.pop(),c=this.stack.pop();this.stack.push(c===p);break;case u.OpCode.GREATER_THAN:var l=this.stack.pop(),h=this.stack.pop();this.stack.push(h>l);break;case u.OpCode.LESS_THAN:var f=this.stack.pop(),d=this.stack.pop();this.stack.push(d<f);break;case u.OpCode.ADD:var m=this.stack.pop(),y=this.stack.pop();if("number"==typeof y&&"number"==typeof m)this.stack.push(y+m);else{if("string"!=typeof y&&"string"!=typeof m)throw new Error("VM Error: Operands must be two numbers or at least one string.");this.stack.push(String(y)+String(m))}break;case u.OpCode.SUBTRACT:var k=this.stack.pop(),v=this.stack.pop();if("number"!=typeof v||"number"!=typeof k)throw new Error("VM Error: Operands must be two numbers.");this.stack.push(v-k);break;case u.OpCode.MULTIPLY:var b=this.stack.pop(),E=this.stack.pop();if("number"==typeof E&&"number"==typeof b)this.stack.push(E*b);else if("string"==typeof E&&"number"==typeof b)this.stack.push(E.repeat(b));else{if("number"!=typeof E||"string"!=typeof b)throw new Error("VM Error: Operands must be two numbers. Or one string and one number.");this.stack.push(b.repeat(E))}break;case u.OpCode.DIVIDE:var C=this.stack.pop(),L=this.stack.pop();if("number"!=typeof L||"number"!=typeof C)throw new Error("VM Error: Operands must be two numbers.");this.stack.push(L/C);break;case u.OpCode.NEGATE:this.stack.push(!this.stack.pop());break;case u.OpCode.JUMP:var S,O=this.readShort();null!==(S=this.settings.hooks)&&void 0!==S&&S.beforeJump&&this.settings.hooks.beforeJump(this,"JUMP"),this.frame.ip+=O;break;case u.OpCode.JUMP_IF_FALSE:var x,A=this.readShort();null!==(x=this.settings.hooks)&&void 0!==x&&x.beforeJump&&this.settings.hooks.beforeJump(this,"JUMP_IF_FALSE"),this.stack[this.stack.length-1]||(this.frame.ip+=A);break;case u.OpCode.CALL:var T=this.readByte(),P=this.stack[this.stack.length-1-T];if(!P||"object"!==(0,i.default)(P)||void 0===P.arity)throw new Error("VM Error: Can only call functions.");if(T!==P.arity)throw new Error("VM Error: Expected ".concat(P.arity," arguments but got ").concat(T,"."));var g={func:P,ip:0,stackStart:this.stack.length-T};this.frames.push(g),this.frame=g;break;case u.OpCode.RETURN:var N=this.stack.pop();if(this.frames.pop(),0===this.frames.length)return N;this.stack.splice(this.frame.stackStart),this.stack.push(N),this.frame=this.frames[this.frames.length-1];break;case u.OpCode.CALL_BUILTIN:var R=this.readConstant(),_=this.readByte(),I=this.stack.splice(this.stack.length-_,_),U=this.settings.builtInFunctions[R];if(!U)throw new Error("VM Error: Built-in function ".concat(R," not found."));var w=U.apply(void 0,(0,n.default)(I));this.stack.push(void 0===w?null:w);break;default:throw new Error("VM Error: Unknown opcode ".concat(e))}}}}])},{"../const/opcodes":17,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/defineProperty":5,"@babel/runtime/helpers/interopRequireDefault":6,"@babel/runtime/helpers/toConsumableArray":9,"@babel/runtime/helpers/typeof":12}]},{},[18]);
//# sourceMappingURL=SnowFall.min.js.map